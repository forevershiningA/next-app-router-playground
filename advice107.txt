Here are the corrected files.

What was wrong:

The Sky: In AtmosphericSky.tsx, the colors were explicitly set to "Muted teal" and "Neutral greenish-grey" in the code. I have updated these to a vibrant sky blue and a soft horizon white/blue.

The Grass: In Scene.tsx, the grass looked blue because of the Fog color and the Hemisphere Light color. They were set to a grey/teal tone that washed out the green. I have updated the lighting to be warmer and the fog to match the new blue sky, while adjusting the grass base color to be a richer, warmer green.

1. Update AtmosphericSky.tsx
code
Tsx
download
content_copy
expand_less
// AtmosphericSky.tsx
import * as THREE from 'three';
import { useRef } from 'react';
import { useFrame } from '@react-three/fiber';
import { Clouds, Cloud } from '@react-three/drei';

const SkyMaterial = {
  uniforms: {
    // UPDATED: Rich Sky Blue
    uColorTop: { value: new THREE.Color('#3b93ff') },    
    // UPDATED: Light White/Blue for horizon (blends with fog)
    uColorBottom: { value: new THREE.Color('#dbecf8') }, 
    uSunPosition: { value: new THREE.Vector3(10, 20, 10) },
  },
  vertexShader: `
    varying vec3 vWorldPosition;
    varying vec2 vUv;
    void main() {
      vUv = uv;
      vec4 worldPosition = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,
  fragmentShader: `
    uniform vec3 uColorTop;
    uniform vec3 uColorBottom;
    varying vec3 vWorldPosition;
    varying vec2 vUv;

    void main() {
      vec3 direction = normalize(vWorldPosition);
      float y = direction.y; 

      // Smooth gradient from horizon to zenith
      float t = max(0.0, (y + 0.15) * 0.8);
      t = pow(t, 0.6); 

      vec3 color = mix(uColorBottom, uColorTop, t);

      // Add subtle dithering
      float noise = fract(sin(dot(vUv, vec2(12.9898, 78.233))) * 43758.5453);
      color += (noise - 0.5) * 0.01;

      gl_FragColor = vec4(color, 1.0);
    }
  `
};

export default function AtmosphericSky() {
  return (
    <group>
      {/* The Sky Dome */}
      <mesh scale={[-1, 1, 1]}>
        <sphereGeometry args={[60, 64, 64]} />
        <shaderMaterial
          attach="material"
          args={[SkyMaterial]}
          side={THREE.BackSide}
        />
      </mesh>

      {/* WHITE FLUFFY CLOUDS */}
      <Clouds material={THREE.MeshBasicMaterial}>
        <Cloud 
          seed={10} 
          bounds={[50, 6, 50]} 
          segments={40} 
          volume={10} 
          color="#ffffff"
          opacity={0.8} 
          position={[0, 10, -10]} 
          speed={0.1} 
        />
        <Cloud 
          seed={20} 
          bounds={[50, 6, 50]} 
          segments={40} 
          volume={10} 
          color="#ffffff" 
          opacity={0.5} 
          position={[0, 15, 0]} 
          speed={0.05} 
        />
      </Clouds>
    </group>
  );
}
2. Update Scene.tsx
code
Tsx
download
content_copy
expand_less
'use client';
import { OrbitControls, Environment, ContactShadows, useTexture, Sparkles } from '@react-three/drei';
import * as THREE from 'three';
import HeadstoneAssembly from './headstone/HeadstoneAssembly';
import AtmosphericSky from './AtmosphericSky';
import { useHeadstoneStore } from '#/lib/headstone-store';

import { useFrame } from '@react-three/fiber';
import { useRef, Suspense } from 'react';

// --- CONFIGURATION ---
// UPDATED: A slightly warmer, richer green to counteract blue sky light
const GRASS_COLOR = '#355c18'; 
// UPDATED: Horizon color matches the Sky bottom color
const FOG_COLOR = '#dbecf8';

function GrassFloor() {
  // Load grass textures from local public folder
  const props = useTexture({
    map: '/textures/grass_color.jpg',
    normalMap: '/textures/grass_normal.jpg',
    roughnessMap: '/textures/grass_roughness.jpg',
    aoMap: '/textures/grass_ao.jpg',
  });

  // --- TEXTURE FIXES ---
  const REPEAT_SCALE = 12; 

  props.map.repeat.set(REPEAT_SCALE, REPEAT_SCALE);
  props.normalMap.repeat.set(REPEAT_SCALE, REPEAT_SCALE);
  props.roughnessMap.repeat.set(REPEAT_SCALE, REPEAT_SCALE);
  props.aoMap.repeat.set(REPEAT_SCALE, REPEAT_SCALE);

  [props.map, props.normalMap, props.roughnessMap, props.aoMap].forEach((tex) => {
    tex.wrapS = tex.wrapT = THREE.MirroredRepeatWrapping;
  });

  return (
    <group position={[0, -0.01, 0]}>
      <mesh rotation={[-Math.PI / 2, 0, 0]} receiveShadow>
        <planeGeometry args={[150, 150]} />
        <meshStandardMaterial 
          {...props}
          color={GRASS_COLOR}
          roughness={0.9}
          normalScale={new THREE.Vector2(0.5, 0.5)}
          metalness={0}
          envMapIntensity={0}
          fog={true} // Changed to true so the floor blends into the distance
        />
      </mesh>
      
      <ContactShadows
        position={[0, 0.01, 0]}
        scale={20}
        blur={2.5}
        opacity={0.6}
        far={10}
        color="#000000"
      />
    </group>
  );
}

function SimpleGrassFloor() {
  return (
    <group position={[0, -0.01, 0]}>
      <mesh rotation={[-Math.PI / 2, 0, 0]} receiveShadow>
        <planeGeometry args={[150, 150]} />
        <meshStandardMaterial color={GRASS_COLOR} roughness={0.9} />
      </mesh>
      <ContactShadows position={[0, 0.01, 0]} scale={20} blur={2.5} opacity={0.6} color="#000000" />
    </group>
  );
}

export default function Scene({ 
  targetRotation = 0,
  currentRotation
}: { 
  targetRotation?: number;
  currentRotation?: React.MutableRefObject<number>;
}) {
  const groupRef = useRef<THREE.Group>(null);
  const is2DMode = useHeadstoneStore((s) => s.is2DMode);
  const baseSwapping = useHeadstoneStore((s) => s.baseSwapping);
  const setSelected = useHeadstoneStore((s) => s.setSelected);
  const setEditingObject = useHeadstoneStore((s) => s.setEditingObject);
  const setSelectedInscriptionId = useHeadstoneStore((s) => s.setSelectedInscriptionId);
  const setSelectedAdditionId = useHeadstoneStore((s) => s.setSelectedAdditionId);
  const setSelectedMotifId = useHeadstoneStore((s) => s.setSelectedMotifId);

  useFrame(() => {
    if (groupRef.current && currentRotation) {
      const diff = targetRotation - currentRotation.current;
      const delta = diff * 0.1; 
      
      if (Math.abs(diff) > 0.001) {
        currentRotation.current += delta;
        groupRef.current.rotation.y = currentRotation.current;
      }
    }
  });

  const handleCanvasClick = (e: any) => {
    if (e.eventObject === e.object) {
      setSelected(null);
      setEditingObject('headstone');
      setSelectedInscriptionId(null);
      setSelectedAdditionId(null);
      setSelectedMotifId(null);
    }
  };

  return (
    <>
      {is2DMode && <color attach="background" args={['#CFE8FC']} />}
      
      {/* Fog: Updated to match the new Sky Bottom Color (Blue/White) */}
      {!is2DMode && <fog attach="fog" args={[FOG_COLOR, 80, 160]} />}
      
      <mesh
        position={[0, 0, -5]}
        onClick={handleCanvasClick}
      >
        <planeGeometry args={[100, 100]} />
        <meshBasicMaterial transparent opacity={0} />
      </mesh>
      
      {!is2DMode && <AtmosphericSky />}
      
      {!is2DMode && (
         <Sparkles 
           count={40}
           scale={10}
           size={2}
           speed={0.4}
           opacity={0.3}
           color="#fff"
           position={[0, 2, 0]}
         />
      )}
      
      {/* --- LIGHTING --- */}
      <ambientLight intensity={0.5} color="#ffffff" />
      
      {/* Hemisphere: Sky color matches Fog, Ground color matches Grass */}
      <hemisphereLight
        args={[FOG_COLOR, '#2d4c1e']}
        intensity={0.4}
      />
      
      <spotLight 
        color="#fffce6" // Slightly warm sun light
        intensity={2.5}
        angle={0.6}
        penumbra={0.5}
        position={[-5, 8, 8]}
        castShadow
        shadow-bias={-0.0001}
      />

      <pointLight position={[5, 2, 5]} intensity={0.5} color="#ffffff" />
      <pointLight position={[-5, 2, 5]} intensity={0.5} color="#ffffff" />
      
      <spotLight color="#ffffff" intensity={1.2} position={[-5, 4, -5]} />
      <spotLight color="#ffffff" intensity={1.2} position={[5, 4, -5]} />
      
      <pointLight position={[0, 10, 0]} intensity={0.8} color="#ffffff" />

      <Environment
        preset="forest"
        background={false}
      />

      <group ref={groupRef}>
        <HeadstoneAssembly />
      </group>
      
      <Suspense fallback={<SimpleGrassFloor />}>
        <GrassFloor />
      </Suspense>

      <OrbitControls
        makeDefault
        enabled={!baseSwapping}
        enableDamping={true}
        dampingFactor={baseSwapping ? 0 : 0.05}
        enableRotate={!is2DMode}
        enableZoom={!is2DMode}
        enablePan={!is2DMode}
        rotateSpeed={0.5}
        zoomSpeed={0.8}
        panSpeed={0.8}
        minPolarAngle={Math.PI / 3.5}
        maxPolarAngle={Math.PI / 2 - 0.05} 
      />
    </>
  );
}