The "Grass disappeared" issue is happening because you have multiple Fog definitions fighting each other in your Scene.tsx. The brown fog (from the previous sunset code) is covering up the green floor because the fog color (#8a5c32) is brown, so the floor fades to brown immediately.

To fix the "lame" look, we will:

Remove the conflicting fogs.

Add texture to the grass using a public URL (so you don't need to download files manually).

Brighten the clouds to pure white.

Here is the fixed code.

1. Update AtmosphericSky.tsx (White Fluffy Clouds)

I have updated the cloud settings to be white, fluffier, and positioned better.

code
Tsx
download
content_copy
expand_less
import * as THREE from 'three';
import { useRef } from 'react';
import { useFrame } from '@react-three/fiber';
import { Clouds, Cloud } from '@react-three/drei';

const SkyMaterial = {
  uniforms: {
    uColorTop: { value: new THREE.Color('#005c97') },    // Deep Blue Zenith
    uColorBottom: { value: new THREE.Color('#e0f2fe') }, // Horizon Haze
  },
  vertexShader: `
    varying vec3 vWorldPosition;
    varying vec2 vUv;
    void main() {
      vUv = uv;
      vec4 worldPosition = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,
  fragmentShader: `
    uniform vec3 uColorTop;
    uniform vec3 uColorBottom;
    varying vec3 vWorldPosition;
    varying vec2 vUv;

    void main() {
      vec3 direction = normalize(vWorldPosition);
      float y = direction.y; 

      // Curve the gradient to make the horizon feel distant
      float t = max(0.0, (y + 0.15) * 0.8);
      t = pow(t, 0.6); 

      vec3 color = mix(uColorBottom, uColorTop, t);

      // Dithering (prevents banding)
      float noise = fract(sin(dot(vUv, vec2(12.9898, 78.233))) * 43758.5453);
      color += (noise - 0.5) * 0.01;

      gl_FragColor = vec4(color, 1.0);
    }
  `
};

export default function AtmosphericSky() {
  return (
    <group>
      {/* Sky Dome */}
      <mesh scale={[-1, 1, 1]}>
        <sphereGeometry args={[60, 64, 64]} />
        <shaderMaterial
          attach="material"
          args={[SkyMaterial]}
          side={THREE.BackSide}
        />
      </mesh>

      {/* WHITE CLOUDS */}
      <Clouds material={THREE.MeshBasicMaterial}>
        <Cloud 
          seed={10} 
          bounds={[50, 6, 50]} 
          segments={40} 
          volume={10} 
          color="#ffffff" // Pure White
          opacity={0.5} 
          position={[0, 10, -10]} 
          speed={0.1} 
        />
        <Cloud 
          seed={20} 
          bounds={[50, 6, 50]} 
          segments={40} 
          volume={10} 
          color="#ffffff" 
          opacity={0.3} 
          position={[0, 15, 0]} 
          speed={0.05} 
        />
      </Clouds>
    </group>
  );
}
2. Update Scene.tsx (Fixing the Fog & Grass)

I have replaced the GrassFloor with one that loads a texture from a public CDN. This will make it look like real grass instantly.

Crucial Step: I removed the old fog lines. There is now only one fog line, and it is Blue (#e0f2fe) to match the sky.

code
Tsx
download
content_copy
expand_less
'use client';
import { OrbitControls, Environment, ContactShadows, useTexture, Sparkles } from '@react-three/drei';
import * as THREE from 'three';
import HeadstoneAssembly from './headstone/HeadstoneAssembly';
import AtmosphericSky from './AtmosphericSky';
import { useHeadstoneStore } from '#/lib/headstone-store';
import { useFrame } from '@react-three/fiber';
import { useRef, Suspense } from 'react';

// --- CONFIGURATION ---
const FOG_COLOR = '#e0f2fe'; // Matches the bottom of AtmosphericSky
const GRASS_COLOR = '#4a7038'; // Natural Olive Green

function GrassFloor() {
  // 1. Load a real grass texture from a public CDN so it looks natural immediately
  const props = useTexture({
    map: 'https://raw.githubusercontent.com/pmndrs/drei-assets/456060a26bbeb8fdf9d32c37c77b8d0174050469/group/grass/grass_color.jpg',
    normalMap: 'https://raw.githubusercontent.com/pmndrs/drei-assets/456060a26bbeb8fdf9d32c37c77b8d0174050469/group/grass/grass_normal.jpg',
    roughnessMap: 'https://raw.githubusercontent.com/pmndrs/drei-assets/456060a26bbeb8fdf9d32c37c77b8d0174050469/group/grass/grass_roughness.jpg',
  });

  // 2. Repeat the texture so it covers the whole floor
  props.map.repeat.set(16, 16);
  props.normalMap.repeat.set(16, 16);
  props.roughnessMap.repeat.set(16, 16);
  props.map.wrapS = props.map.wrapT = THREE.RepeatWrapping;
  props.normalMap.wrapS = props.normalMap.wrapT = THREE.RepeatWrapping;
  props.roughnessMap.wrapS = props.roughnessMap.wrapT = THREE.RepeatWrapping;

  return (
    <group position={[0, -0.01, 0]}>
      <mesh rotation={[-Math.PI / 2, 0, 0]} receiveShadow>
        <planeGeometry args={[100, 100]} />
        <meshStandardMaterial 
          {...props}
          color={GRASS_COLOR} // Tint the texture slightly green
          roughness={0.8}
          metalness={0}
        />
      </mesh>
      
      {/* Contact Shadow for realism */}
      <ContactShadows
        position={[0, 0.01, 0]}
        scale={15}
        blur={2}
        opacity={0.7}
        far={10}
        color="#041202"
      />
    </group>
  );
}

// Fallback if internet is slow/textures fail
function SimpleGrassFloor() {
  return (
    <group position={[0, -0.01, 0]}>
      <mesh rotation={[-Math.PI / 2, 0, 0]} receiveShadow>
        <planeGeometry args={[100, 100]} />
        <meshStandardMaterial color={GRASS_COLOR} roughness={1} />
      </mesh>
      <ContactShadows position={[0, 0.01, 0]} scale={15} blur={2} opacity={0.7} color="#041202" />
    </group>
  );
}

export default function Scene({ 
  targetRotation = 0,
  currentRotation
}: { 
  targetRotation?: number;
  currentRotation?: React.MutableRefObject<number>;
}) {
  const groupRef = useRef<THREE.Group>(null);
  const is2DMode = useHeadstoneStore((s) => s.is2DMode);
  const baseSwapping = useHeadstoneStore((s) => s.baseSwapping);
  const setSelected = useHeadstoneStore((s) => s.setSelected);
  const setEditingObject = useHeadstoneStore((s) => s.setEditingObject);
  const setSelectedInscriptionId = useHeadstoneStore((s) => s.setSelectedInscriptionId);
  const setSelectedAdditionId = useHeadstoneStore((s) => s.setSelectedAdditionId);
  const setSelectedMotifId = useHeadstoneStore((s) => s.setSelectedMotifId);

  useFrame(() => {
    if (groupRef.current && currentRotation) {
      const diff = targetRotation - currentRotation.current;
      const delta = diff * 0.1;
      if (Math.abs(diff) > 0.001) {
        currentRotation.current += delta;
        groupRef.current.rotation.y = currentRotation.current;
      }
    }
  });

  const handleCanvasClick = (e: any) => {
    if (e.eventObject === e.object) {
      setSelected(null);
      setEditingObject('headstone');
      setSelectedInscriptionId(null);
      setSelectedAdditionId(null);
      setSelectedMotifId(null);
    }
  };

  return (
    <>
      {is2DMode && <color attach="background" args={['#CFE8FC']} />}
      
      {/* --- IMPORTANT FIX: SINGLE FOG DEFINITION --- */}
      {/* 
         Previous code had multiple <fog> lines. 
         This single Blue fog blends the floor into the sky perfectly.
      */}
      {!is2DMode && <fog attach="fog" args={[FOG_COLOR, 12, 45]} />}
      
      <mesh position={[0, 0, -5]} onClick={handleCanvasClick}>
        <planeGeometry args={[100, 100]} />
        <meshBasicMaterial transparent opacity={0} />
      </mesh>
      
      {!is2DMode && <AtmosphericSky />}
      
      {/* Subtle dust motes */}
      {!is2DMode && (
         <Sparkles 
           count={60}
           scale={10}
           size={2}
           speed={0.4}
           opacity={0.4}
           color="#fff"
           position={[0, 2, 0]}
         />
      )}
      
      {/* --- LIGHTING --- */}
      <ambientLight intensity={0.7} color="#dbeafe" />
      
      <spotLight 
        color="#fffce8"
        intensity={2.2}
        angle={0.5}
        penumbra={0.5}
        position={[8, 12, 8]} 
        castShadow
        shadow-mapSize={[2048, 2048]}
        shadow-bias={-0.0001}
      />

      <spotLight 
        color="#bfdbfe"
        intensity={0.8}
        position={[-5, 2, -5]}
      />
      
      {/* "City" preset makes the granite look shiny and expensive */}
      <Environment 
        preset="city" 
        environmentIntensity={0.6}
        background={false}
      />

      <group ref={groupRef}>
        <HeadstoneAssembly />
      </group>
      
      {/* TEXTURED FLOOR */}
      <Suspense fallback={<SimpleGrassFloor />}>
        <GrassFloor />
      </Suspense>

      <OrbitControls
        makeDefault
        enabled={!baseSwapping}
        enableDamping={true}
        dampingFactor={baseSwapping ? 0 : 0.05}
        enableRotate={!is2DMode}
        enableZoom={!is2DMode}
        enablePan={!is2DMode}
        rotateSpeed={0.5}
        zoomSpeed={0.8}
        panSpeed={0.8}
        minPolarAngle={Math.PI / 4}
        maxPolarAngle={Math.PI / 2 - 0.02}
      />
    </>
  );
}